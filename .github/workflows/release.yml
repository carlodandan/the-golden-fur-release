name: Build Electron App (The Golden Fur)

on:
  workflow_dispatch:

jobs:
  build-windows:
    runs-on: windows-2025
    env:
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    permissions:
      contents: write
  
    steps:
      # 1. Check out the repository code
      - name: Checkout Code
        uses: actions/checkout@v4

      # 2. Setup Node.js environment
      - uses: pnpm/action-setup@v4
        with:
          version: 10

      # 3. Install dependencies cleanly
      - name: Install Dependencies
        run: |
          git clone --depth=1 https://${{ secrets.PERSONAL_TOKEN }}@github.com/carlodandan/the-golden-fur-app
          cd the-golden-fur
          touch .env
          echo "GITHUB_TOKEN=${{ secrets.GITHUB_TOKEN }}" >> .env
          echo "SUPABASE_URL=${{ secrets.SUPABASE_URL }}" >> .env
          echo "SUPABASE_ANON_KEY=${{ secrets.SUPABASE_ANON_KEY }}" >> .env
          pnpm install

      # 4. Build the application (Electron Forge make)
      # This runs the 'make' script from your package.json
      - name: Build
        run: cd the-golden-fur && pnpm run publish
